<view class="container">
  
  <view class="header-section">
    <view class="location-pill" bindtap="handleChooseLocation">
      <text class="icon">ğŸ“</text>
      <text class="text">{{location ? location.address : 'ç‚¹å‡»é€‰æ‹©ä½ç½®'}}</text>
    </view>
    <view class="app-title">
      <text class="main">æ™¾è¡£åŠ©æ‰‹</text>
    </view>
  </view>

  <view class="card hero-card" wx:if="{{todayForecast}}">
    <view class="date-badge">{{todayForecast.dateDisplay}}</view>
    
    <view class="score-container">
      <view class="score-circle {{todayForecast.color}}">
        <text class="score-num">{{todayForecast.drying_index_display}}</text>
        <text class="score-label">æŒ‡æ•°</text>
      </view>
      <view class="score-info">
        <text class="status-text {{todayForecast.color}}">{{todayForecast.recommendation}}</text>
        <text class="desc-text" wx:if="{{todayForecast.drying_index >= 70}}">é˜³å…‰å……è¶³ï¼Œé€Ÿå¹²ï¼</text>
        <text class="desc-text" wx:elif="{{todayForecast.drying_index >= 30}}">å¤©æ°”å°šå¯ï¼Œè€å¿ƒç­‰å¾…</text>
        <text class="desc-text" wx:else>å»ºè®®æ”¹ä¸ºå®¤å†…çƒ˜å¹²</text>
      </view>
    </view>
  </view>

  <!-- NEW: Pill Timeline Section -->
  <view class="drying-section" wx:if="{{todayForecast && todayForecast.drying_pills.length > 0}}">
    <view class="section-title">ä»Šæ—¥æ™¾æ™’æ—¶æ®µ</view>

    <scroll-view class="timeline-scroll" scroll-x enable-flex>
      <view class="timeline-container">
        
        <!-- Layer 1: Time Ticks -->
        <view class="timeline-track">
          <block wx:for="{{todayForecast.hourly_data}}" wx:key="timeDisplay">
            <view class="time-slot" style="width: {{slotWidth}}rpx;">
              <view class="time-text">{{item.timeDisplay}}</view>
              <view class="tick-mark"></view>
            </view>
          </block>
        </view>

        <!-- Layer 2: Pill Ranges -->
        <view class="pills-layer">
          <block wx:for="{{todayForecast.drying_pills}}" wx:key="left">
            <view class="pill-item" style="left: {{item.left}}rpx; width: {{item.width}}rpx;">
              <view class="pill-body">
                <view class="pill-icon">â˜€ï¸</view>
                <text class="pill-text" wx:if="{{item.isLong}}">é€‚å®œæ™¾æ™’</text>
              </view>
              <view class="pill-range-tag">
                {{item.label}}
              </view>
            </view>
          </block>
        </view>

      </view>
    </scroll-view>
  </view>

  <view class="metrics-container" wx:if="{{todayForecast}}">
    <view class="metric-box">
      <view class="metric-icon blue">ğŸŒ¡ï¸</view>
      <view class="metric-data">
        <text class="label">æ¸©åº¦</text>
        <text class="value">{{todayForecast.avg_temp_display}}Â°</text>
      </view>
    </view>
    <view class="metric-box">
      <view class="metric-icon cyan">ğŸ’§</view>
      <view class="metric-data">
        <text class="label">æ¹¿åº¦</text>
        <text class="value">{{todayForecast.avg_humidity_display}}%</text>
      </view>
    </view>
    <view class="metric-box">
      <view class="metric-icon purple">ğŸ’¨</view>
      <view class="metric-data">
        <text class="label">é£é€Ÿ</text>
        <text class="value">{{todayForecast.avg_wind_display}}</text>
      </view>
    </view>
    <view class="metric-box">
      <view class="metric-icon indigo">â˜”</view>
      <view class="metric-data">
        <text class="label">é™é›¨</text>
        <text class="value">{{todayForecast.rain_probability_display}}%</text>
      </view>
    </view>
  </view>

  <view class="action-grid">
    <button class="action-btn" bindtap="fetchWeather">ğŸ”„ åˆ·æ–°</button>
    <button class="action-btn" bindtap="goToForecast">ğŸ“… 5å¤©é¢„æŠ¥</button>
  </view>
</view>